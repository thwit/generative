from __future__ import division
import pens

def hex_to_rgb(h):
    if isinstance(h, list):
        cols = []
        for h_ in h:
            h_ = h_.lstrip('#')
            cols.append(tuple(int(h_[i:i+2], 16) for i in (0, 2, 4)))
        return cols
        
    h = h.lstrip('#')
    return tuple(int(h[i:i+2], 16) for i in (0, 2, 4))
    
def keyReleased():
    global flag
    
    if key == ENTER:
        flag = True
        
def setup():
    global pg, colors, strk_col, fill_col, bg_col, pwidth, pheight, flag, margin, pen
    size(600, 600)

    #### COLOR DEFINITIONS
    colors = ['#2a241b','#67482f','#ac3d20','#ebddd8','#3a3f43']
    bg_col = '#a99384'
    bg_col = '#ffffff'
    strk_col = '#000000'
    
    bg_col = hex_to_rgb(bg_col)
    strk_col = hex_to_rgb(strk_col)
    colors = hex_to_rgb(colors)
    
    #### LAYOUT PARAMETERS
    # Scale applied to width and height to get PGraphics drawing size
    scale_ = 1
    
    # PGraphics drawing size
    pwidth, pheight = width*scale_, height*scale_
    
    # Margins around the drawing
    margin = 30 * scale_
    
    # STYLE PARAMETERS
    stroke_cap = ROUND
    stroke_weight = 2
    n_loop = 1
    
    # Create and setup PGraphics
    pg = createGraphics(pwidth + margin * 2, pheight + margin * 2)
    pen = pens.Pen2B(pg)
    
    flag = True
    
def draw():
    global flag, bg_col, strk_col, pwidth, margin, pheight, pen
    
    if flag:
        print('Generating new set of lines')
        flag = False
        
        pg.beginDraw()
    
        # Set background color
        
        pg.noStroke()
        pg.fill(*bg_col)
        pg.rect(-1, -1, pwidth + margin * 2 + 1, pheight + margin * 2 + 1)
        
        pg.strokeWeight(1)
        # Push matrix and translate coordinate system so (0,0) is at (margin, margin)
        pg.pushMatrix()
        pg.translate(margin, margin)
        pg.stroke(*strk_col)
        
        for _ in range(25):
            #td.PenLine2().line(PVector(random(pwidth), random(pheight)), PVector(random(pwidth), random(pheight)), strk_col, pg)
            pen.circle(PVector(random(100, 500), random(100, 500)), random(10,100))
        
        
            
        # End drawing on PGraphics    
        pg.popMatrix()
        pg.endDraw()
        
        # Display final drawing and save to .png in same folder
        image(pg, 0, 0, width, height)
        pg.save("template.png")
